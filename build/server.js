require("source-map-support").install(),function(e,n){for(var t in n)e[t]=n[t]}(exports,function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=11)}([function(e,n){e.exports=require("react")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("moment")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("express-promise-router")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("compression")},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("react-dom/server")},function(e,n,t){"use strict";t.r(n);var r=t(5),o=t(3),i=t(6),u=t.n(i),a=t(4),s=t(7),c=t(8),l=t(9),d=t(1),f=t.n(d),p=t(0),m=t(10),h=function(){return p.createElement("html",{lang:"en",className:""},p.createElement("head",null,p.createElement("meta",{charSet:"utf-8"}),p.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1, shrink-to-fit=no"}),p.createElement("title",null,"LMS"),p.createElement("link",{rel:"shortcut icon",href:"",type:"image/png"}),p.createElement("link",{rel:"stylesheet",href:"//cdn.jsdelivr.net/npm/semantic-ui@2.4.0/dist/semantic.min.css"}),p.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"body {\n                    background-color: #eeeff1;\n                }"}})),p.createElement("body",null,p.createElement("div",{id:"app"}),p.createElement("script",{type:"text/javascript",src:"/app.js"})))},v=t(2),y=new(0,f.a.Schema)({name:String,description:String,from:Date,to:Date,image:String,lecturer:String,students:[String],capacity:Number}),b=f.a.model("Course",y),g=new(0,f.a.Schema)({name:String,email:String,phone:String,registered:Date,image:String,enrolledCourses:[String],attendance:Number,premium:Boolean}),w=f.a.model("Student",g),S=new(0,f.a.Schema)({name:String,email:String,phone:String,image:String,coursesTeaching:[String],rating:Number}),x=f.a.model("Lecturer",S),j=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(u,a)}s((r=r.apply(e,n||[])).next())})},I=function(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function _(e){return{id:e._id.toString(),name:e.name,email:e.email,image:e.image,coursesTeaching:e.coursesTeaching,rating:e.rating}}var k=function(){return(k=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},P=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(u,a)}s((r=r.apply(e,n||[])).next())})},E=function(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function q(e){return{id:e._id.toString(),name:e.name,description:e.description,from:v(e.from).format("YYYY-MM-DD"),to:v(e.to).format("YYYY-MM-DD"),image:e.image,capacity:e.capacity,lecturer:e.lecturer,students:e.students.length}}function B(e){return{name:e.name,description:e.description,from:v(e.from),to:v(e.to),image:e.image,capacity:e.capacity,students:[],lecturer:e.lecturer}}var C=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(u,a)}s((r=r.apply(e,n||[])).next())})},M=function(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function O(e){return{id:e._id.toString(),name:e.name,email:e.email,phone:e.phone,registered:v(e.registered).format("YYYY-MM-DD"),image:e.image,enrolledCourse:e.enrolledCourse,attendance:e.attendance,premium:e.premium}}function T(e){return e.map(function(e){var n=O(e);return n.enrolledCourse=function(e){return e?e.length:0}(n.enrolledCourse),n})}function Y(e){return{name:e.name,email:e.email,phone:e.phone,registered:v(),image:e.image,attendance:Math.floor(100*Math.random()+1),enrolledCourses:[],premium:e.premium}}var D=function(){return(D=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},U=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(u,a)}s((r=r.apply(e,n||[])).next())})},A=function(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function N(e,n){return e.map(function(e){return D({},q(e),{students:n.filter(function(n){return e.students.includes(n._id.toString())})})})}function G(e,n,t){return e.filter(function(e){return t?n[n.enrolledCourses?"enrolledCourses":"students"].includes(e._id.toString()):!n[n.enrolledCourses?"enrolledCourses":"students"].includes(e._id.toString())})}var R=o(),L=u()({caseSensitive:!0,strict:!0});R.use(L),R.listen(process.env.NODE_SERVER_PORT||3e3),console.info("Server is running on port 3000"),R.use(c()),R.use("/app.js",o.static(r.join(__dirname,"./public/js/app.js"))),R.use(s()),R.use(a.urlencoded({limit:"1mb",extended:!0})),R.use(a.json({limit:"1mb"})),R.use(l({secret:"olms",resave:!1,saveUninitialized:!0,cookie:{secure:!0}}));R.use("/api/*",function(e,n,t){f.a.connect("mongodb://admin:password1@ds157923.mlab.com:57923/lms",{useNewUrlParser:!0});var r=f.a.connection;e.app.locals.db=r,r.on("error",console.error.bind(console,"MongoDB connection error:")),t()}),R.get("/api/courses",function(e,n){return P(void 0,void 0,void 0,function(){var e,t;return E(this,function(r){switch(r.label){case 0:return[4,b.find({})];case 1:return e=r.sent(),t=e.map(function(e){return q(e)}),n.json(t),[2]}})})}),R.get("/api/students",function(e,n){return C(void 0,void 0,void 0,function(){var e,t;return M(this,function(r){switch(r.label){case 0:return[4,w.find({})];case 1:return e=r.sent(),t=T(e),n.json(t),[2]}})})}),R.get("/api/students/search/:search",function(e,n){return C(void 0,void 0,void 0,function(){var t,r;return M(this,function(o){switch(o.label){case 0:return[4,w.find({name:new RegExp(e.params.search,"gi")})];case 1:return t=o.sent(),r=T(t),n.json(r),[2]}})})}),R.post("/api/student/register",function(e,n){return C(void 0,void 0,void 0,function(){var t;return M(this,function(r){switch(r.label){case 0:return console.log(e.body),[4,new w(Y(e.body)).save()];case 1:return t=r.sent(),n.json(t),[2]}})})}),R.get("/api/student/:id",function(e,n){return C(void 0,void 0,void 0,function(){var t,r,o;return M(this,function(i){switch(i.label){case 0:return[4,w.findById(e.params.id)];case 1:return t=i.sent(),[4,b.find({_id:{$in:t.enrolledCourses}})];case 2:return r=i.sent(),(o=O(t)).enrolledCourse=r,n.json(o),[2]}})})}),R.post("/api/student/:id/save",function(e,n){return C(void 0,void 0,void 0,function(){var t,r;return M(this,function(o){switch(o.label){case 0:return delete(t=Y(e.body)).registered,delete t.attendance,delete t.enrolledCourses,[4,w.findByIdAndUpdate(e.params.id,t)];case 1:return r=o.sent(),n.json(r),[2]}})})}),R.post("/api/course/create",function(e,n){return P(void 0,void 0,void 0,function(){var t;return E(this,function(r){switch(r.label){case 0:return[4,new b(B(e.body)).save()];case 1:return t=r.sent(),n.json(t),[2]}})})}),R.get("/api/course/:id",function(e,n){return P(void 0,void 0,void 0,function(){var t,r,o,i,u;return E(this,function(a){switch(a.label){case 0:return[4,b.findById(e.params.id)];case 1:return t=a.sent(),[4,Promise.all([w.find({_id:{$in:t.students}}),x.findById(t.lecturer)])];case 2:return r=a.sent(),o=r[0],i=r[1],u=k({},q(t),{students:o,lecturer:_(i)}),n.json(u),[2]}})})}),R.post("/api/course/:id/save",function(e,n){return P(void 0,void 0,void 0,function(){var t,r;return E(this,function(o){switch(o.label){case 0:return delete(t=B(e.body)).students,[4,b.findByIdAndUpdate(e.params.id,t)];case 1:return r=o.sent(),n.json(r),[2]}})})}),R.get("/api/lecturers",function(e,n){return j(void 0,void 0,void 0,function(){var e;return I(this,function(t){switch(t.label){case 0:return[4,x.find({})];case 1:return e=t.sent().map(function(e){return _(e)}),n.json(e),[2]}})})}),R.get("/api/enrol",function(e,n){return U(void 0,void 0,void 0,function(){var t,r,o,i,u,a,s,c,l,d,f,p,m;return A(this,function(h){switch(h.label){case 0:return t=e.query.courseId,r=e.query.studentId,t&&"undefined"===r?[4,Promise.all([b.findById(t),w.find({})])]:[3,2];case 1:return o=h.sent(),i=o[0],u=o[1],a=G(u,i,!0),s=G(u,i,!1),(c=q(i)).students=a.map(function(e){return O(e)}),[2,n.json({courses:[c],students:s.map(function(e){return O(e)})})];case 2:return[4,Promise.all([b.find({}),w.find({})])];case 3:return l=h.sent(),d=l[0],f=l[1],p=f.find(function(e){return e._id.toString()===r}),m=G(d,p,!1),n.json({courses:N(m,f),students:[O(p)]}),[2]}})})}),R.get("/api/withdraw",function(e,n){return U(void 0,void 0,void 0,function(){var t,r,o,i,u,a,s,c,l,d,f,p,m;return A(this,function(h){switch(h.label){case 0:return console.log(e.query),t=e.query.courseId,r=e.query.studentId,t&&"undefined"===r?[4,Promise.all([b.findById(t),w.find({})])]:[3,2];case 1:return o=h.sent(),i=o[0],u=o[1],a=G(u,i,!0),s=q(i),c=a.map(function(e){return O(e)}),s.students=c,[2,n.json({courses:[s],students:c})];case 2:return[4,Promise.all([b.find({}),w.find({})])];case 3:return l=h.sent(),d=l[0],f=l[1],p=f.find(function(e){return e._id.toString()===r}),m=G(d,p,!0),n.json({courses:N(m,f),students:[O(p)]}),[2]}})})}),R.post("/api/enrol",function(e,n){return U(void 0,void 0,void 0,function(){var t,r,o,i,u;return A(this,function(a){switch(a.label){case 0:return t=e.body.courseId,r=e.body.studentId,[4,Promise.all([b.findById(t),w.findById(r)])];case 1:return o=a.sent(),i=o[0],u=o[1],i.students.push(r),u.enrolledCourses.push(t),[4,Promise.all([b.findByIdAndUpdate(t,i),w.findByIdAndUpdate(r,u)])];case 2:return a.sent(),n.json({}),[2]}})})}),R.post("/api/withdraw",function(e,n){return U(void 0,void 0,void 0,function(){var t,r,o,i,u;return A(this,function(a){switch(a.label){case 0:return console.log({withdraw:e.body}),t=e.body.courseId,r=e.body.studentId,[4,Promise.all([b.findById(t),w.findById(r)])];case 1:return o=a.sent(),i=o[0],u=o[1],i.students=i.students.filter(function(e){return e!==u._id.toString()}),u.enrolledCourses=u.enrolledCourses.filter(function(e){return e!==i._id.toString()}),[4,Promise.all([b.findByIdAndUpdate(t,i),w.findByIdAndUpdate(r,u)])];case 2:return a.sent(),n.json({}),[2]}})})}),R.use("/api/*",function(e,n,t){console.log(e.app.locals.db.readyState),t()}),R.get("/*",function(e,n){var t=m.renderToStaticMarkup(p.createElement(h,null));n.send("<!doctype html>"+t)})}]));
//# sourceMappingURL=server.js.map